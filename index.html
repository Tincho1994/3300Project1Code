<!DOCTYPE html>
<html>
<head>
	<style>
		#boroughs { stroke: grey;
					stroke-width: 0.7px;
					fill: transparent; }
		svg {border: solid black 1px; }
	</style>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v2.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
</head>
<body>
<!-- NYC Map Code: http://bl.ocks.org/phil-pedruco/6646844 -->

<script>
	var width = 1200,
	   height = 1000;

	var svg = d3.select("body").append("svg")
	    .attr("width", width)
	    .attr("height", height)
	    .attr("fill","#ceff99");
	svg.append("rect")
		.attr("width",width)
		.attr("height",height)
		.attr("fill","#f3ffe6");
	var treeData;
	//var healthScale = d3.scaleOrdinal().domain(["Good", "Fair", "Poor"]).range(["green", "yellow", "red"]);

	// Top 10 Species: 
	//var speciesScale = d3.scaleOrdinal().domain(["London PlaneTree", "Thornless Honeylocust", "Callery Pear", "Swamp Spanish Oak", "Norway Maple", "Little Leaf Linden",
	//											 "Stonefruit Tree", "Japanese Zelkova", "Maidenhair Tree", "Pagoda Tree"])
	//									.range(["#99d36c", "#ffe685", "#fc9e4f", "#f55d3e", "#aa6da3", "#50c5b7", "#88bb92", "#add8e6", "#A43131", "#ffc0cb"]);

	// Top 5 Species:
	var speciesScale = d3.scaleOrdinal().domain(["London PlaneTree", "Thornless Honeylocust", "Callery Pear", "Swamp Spanish Oak", "Norway Maple"])
										.range(["#99d36c", "#fc9e4f", "#50c5b7", "#aa6da3", "#f55d3e"]);
										//green orange blue purple red
	var boroughScale = d3.scaleOrdinal().domain([0,1,2,3,4])
										.range(["#e1e1d0","#cdcdb1","#cdcdb1","#e1e1d0","#e1e1d0"]);

	d3.csv("top5species.csv", function(data) {
		data.forEach(function(d) {
			d.latitude = +d.latitude;
			d.longitude = +d.longitude;
		})
		console.log(data[0]);
		treeData = data;

		var points = new Array(0);
		treeData.forEach(function(tree) {
			var a = new Array(2);
			a[0] = [tree.longitude, tree.latitude];
			a[1] = tree.species;
			points.push(a);
		});

		console.log(points[0]);
		console.log(points[0][1]);

		d3.json("nyc.json", function(error, nyb) {
		    var projection = d3.geoMercator()
		  					.center([-73.94, 40.70])
		  					.scale(90000)
		  					.translate([(width)/2, (height)/2]);

			var path = d3.geoPath()
					.projection(projection);

			var g = svg.append("g");

			var Manhattan = new Array(0);
			var Bronx  = new Array(0);
			var Brooklyn = new Array(0);
			var Queens = new Array(0);
			var Staten = new Array(0);

			for(var i in nyb.features){
				switch(nyb.features[i].properties.boroughCode) {
					case 1:
						Manhattan.push(nyb.features[i])
						break;
					case 2:
						Bronx.push(nyb.features[i])
						break;
					case 3:
						Brooklyn.push(nyb.features[i])
						break;
					case 4:
						Queens.push(nyb.features[i])
						break;
					case 5:
						Staten.push(nyb.features[i])
						break;
				};
			};
			var boroughFeatures = [Manhattan, Bronx, Brooklyn, Queens, Staten];

			for (var i in boroughFeatures){
			g.append("g")
				.attr("id", "boroughs")
				.selectAll(".state")
				.data(boroughFeatures[i])
				.enter().append("path")
				.attr("class", function(d){ return d.properties.name; })
				.attr("d", path)
				.style("fill",boroughScale(i));
			};
			//make trees
			var circles = svg.selectAll("circle").data(points);
			circles.enter().append("circle").attr("r", 1)
			//.merge(circles)
			.attr("cx", function(d) { return projection(d[0])[0]; })
			.attr("cy", function(d) { return projection(d[0])[1]; })
			.style("fill", function(d) {
				return speciesScale(d[1]);
			})
			.style("opacity", 0.5);
			});
	})
</script>
</body>
</html>